{% load static %}

{% include 'header.html' %}
<head>
    <link rel="stylesheet" type="text/css" href="{% static 'css/mystyle.css' %}" media="all">
    <link rel="stylesheet" type="text/css" href="{% static 'css/checkbox.css' %}" media="all">

</head>

<script type="text/javascript">

$(document).ready(function(){
    $('#subquery').click(function(){
        
        var select = document.getElementById("select").value;
        var uniform_numbers = document.getElementById("uniform_numbers").value;
        var company_name_C = document.getElementById("company_name_C").value;

        $.ajax({
            url:"{% url 'subquery_company_admin' %}",
            data :  {
                select,
                uniform_numbers,
                company_name_C,

                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            type:'POST',

            datatype : 'text',

                                
            success:function(data){
                $('#company_list_table').html('');
                $('#company_list_table').html(data);
                $('#company_list').DataTable({
                    "order": [[ 3, "desc" ]],
                    "lengthChange": false,
                    "bInfo" : false,
                    "language": {
                        "paginate": {
                            "previous": "上一頁",
                            "next": "下一頁",
                        },
                        "search": "搜尋表格:"
                    }
                });
            },
                                        
            beforeSend:function(){

                $.blockUI({ css: { 
                            width : '25%',
                            border: 'none', 
                            padding: '15px', 
                            backgroundColor: '#000', 
                            '-webkit-border-radius': '10px', 
                            '-moz-border-radius': '10px', 
                            opacity: .5, 
                            color: '#fff'
                            }
                         });
            },

            complete:function(){
                $.unblockUI();
            },        
            error:function(xhr, ajaxOptions, thrownError){ 
                alert(xhr.status); 
                alert(thrownError);
            }       
        });                                                                                                           
    });

    $('#del_company').click(function(){
        
        // var select = document.getElementById("select").value;
        var file = [];
        $('input:checkbox:checked[name="company_checkbox"]').each(function (i) {
            file[i] = this.value;      
        });

        $.ajax({
            url:"{% url 'del_company' %}",
            data :  {
                'file[]':file,

                csrfmiddlewaretoken: '{{ csrf_token }}'
            },
            type:'POST',

            datatype : 'text',

                                
            success:function(data){
                $('#company_list_table').html('');
                $('#company_list_table').html(data);
                // $('#company_list').DataTable({
                //         "order": [[ 3, "desc" ]]
                // });
                window.location.href = "{% url 'Company_info_admin' %}";
                },
                                        
            beforeSend:function(){

                $.blockUI({ css: { 
                            width : '25%',
                            border: 'none', 
                            padding: '15px', 
                            backgroundColor: '#000', 
                            '-webkit-border-radius': '10px', 
                            '-moz-border-radius': '10px', 
                            opacity: .5, 
                            color: '#fff'
                            }
                         });
            },

            complete:function(){
                $.unblockUI();
            },        
            error:function(xhr, ajaxOptions, thrownError){ 
                alert(xhr.status); 
                alert(thrownError);
            }       
        });                                                                                                           
    });

    $("#select").select2({
        placeholder: "請選擇狀態",
        allowClear: true
    });

    $('#company_list').DataTable({
        "order": [[ 3, "desc" ]],
        "lengthChange": false,
        "bInfo" : false,
        "language": {
            "paginate": {
                "previous": "上一頁",
                "next": "下一頁",
            },
            "search": "搜尋表格:"
        }
    });

    $('#del_company_pre').click(function(){
        $("#modal_del_confirm").modal('show');
    })

    $('#del_company').click(function(){
        $("#modal_del_confirm").modal('hide');
    })

    $("#checkall").click(function(){
        $('input:checkbox').not(this).prop('checked', this.checked);
    });
});
</script>

<div id="id_content">
    <div id = "middle">
        <div width=100% align="center">

            <div id="Sidebar_middle">
	            <ul class="nav nav-tabs">
	                <li>
                        <a href="{% url 'Company_info_admin' %}" style="background-color:#fcfcfc;border-top:2px solid #1982b8;font-weight:bold;">企業基本資料管理</a>
                    </li>
                    <li>
                        <a href="{% url 'Vacancy_M_admin' %}" style="background-color:#fcfcfc;border-top:2px solid #1982b8;font-weight:bold;">刊登職缺管理</a>
                    </li>
	            </ul>
	            <form class="form-horizontal SearchForm">
	                <br><br>
    	            <ul class="nav nav-tabs" style="padding-left: 70px;">
	                	<li><a style="background-color:#fcfcfc;border-bottom:2px solid #B22222;font-weight:bold;box-shadow:5px 5px 8px 2px #ccc;">職缺管理</a></li>
	            	</ul><br>
				 	<div class='FormOption'>
                        <div class="form-group">
	                            
                            <label for="inputPassword3" class="col-sm-3 control-label">審核狀態 : </label>

                            <div class="col-sm-6">
                                <select class="form-control" id = 'select' style='width: 100%'>
                                    <option></option>
                                    <option value='ALL'>ALL</option>
                                    <option value='true'>已審核</option>
                                    <option value='false'>未審核</option>
                                </select>
                            </div><br><br>

                            <label for="inputPassword3" class="col-sm-3 control-label">統一編號 : </label>

                            <div class="col-sm-6">
						      	<input type="text" class="form-control" placeholder="" id="uniform_numbers">
                            </div><br><br>

                            <label for="inputPassword3" class="col-sm-3 control-label">公司名稱 (中文) : </label>

                            <div class="col-sm-6">
						      	<input type="text" class="form-control" placeholder="" id="company_name_C">
                            </div><br><br>

                        </div>
                        <button type ='button' id = "subquery" class="btn btn-primary">查詢</button><br><br>
                    </div><br><br>

                    <div align="left" style="padding-left:70px;">
                    <button type ='button' id ="del_company_pre" class="btn btn-primary">刪除已勾選公司</button><br>
                    </div>

                    {# <table class="table table-scroll" id="company_list" style="width:90%"> #}
                    <div style="width:90%;" id="company_list_table">
                    <table id="company_list">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="checkall"></th>
                                <th>公司名稱</th>
                                <th>統一編號</th>
                                <th>送出日期</th>
                                <th>審核狀態</th>
                                <th>查詢</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in result %}
                                {% if row.0 != 'admin' %}
                                    {% if row.2 == 'true' %}
                                        <tr style="background-color:#90EE90">
                                            <td style="padding:10px 18px;">
                                                <input type="checkbox" name="company_checkbox" value="{{ row.0 }}|{{ row.1 }}|{{ row.3 }}">
                                            </td>
                                            <td>{{ row.0 }}</td>
                                            <td>{{ row.1 }}</td>
                                            <td>{{ row.3 }}</td>
                                            {% if row.2 == 'true' %}
                                                <td>已審核</td>
                                            {% else %}
                                                <td>待審核</td>
                                            {% endif %}
                                            <td><a href="{% url 'Company_review' %}?company_name_C={{ row.0|urlencode }}&date={{ row.3|urlencode }}&account={{ row.4|urlencode }}">查詢</a></td>
                                        </tr>
                                    {% else %}
                                        <tr>
                                            <td style="padding:10px 18px;">
                                                <input type="checkbox" name="company_checkbox" value="{{ row.0 }}|{{ row.1 }}|{{ row.3 }}">
                                            </td>
                                            <td>{{ row.0 }}</td>
                                            <td>{{ row.1 }}</td>
                                            <td>{{ row.3 }}</td>
                                            {% if row.2 == 'true' %}
                                                <td>已審核</td>
                                            {% else %}
                                                <td>待審核</td>
                                            {% endif %}
                                            <td><a href="{% url 'Company_review' %}?company_name_C={{ row.0|urlencode }}&date={{ row.3|urlencode }}&account={{ row.4|urlencode }}">查詢</a></td>
                                        </tr>
                                    {% endif %}
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                    </div><br>

                    <div class="modal fade" id="modal_del_confirm" role="dialog">
                        <div class="modal-dialog">
                          <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">請再次確認!</h4>
                                </div>
                            <div class="modal-body">
                                <p>確定刪除?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" id="del_company">刪除</button>
                                <button type="button" class="btn btn-default" data-dismiss="modal">關閉</button>
                            </div>
                            </div>
                        </div>
                    </div>
	            </form><br>
           	</div>
        </div>

        <div id = 'output'>
        </div>
    </div>
</div><br>


{% include 'footer.html' %}
